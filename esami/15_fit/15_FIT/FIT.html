<!DOCTYPE html>
<!-- saved from url=(0054)https://olj.ing.unimore.it/exam/390/exercise/view/1028 -->
<html lang="it"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="./FIT_files/js"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-JHGNYN9YCB');
    </script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="./FIT_files/themes.css">
    <link rel="shortcut icon" href="https://olj.ing.unimore.it/static/oljApp/imgs/olj_logo_squared.png">
    <link rel="stylesheet" href="./FIT_files/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="./FIT_files/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <script src="./FIT_files/jquery-3.4.1.min.js.download" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="./FIT_files/popper.min.js.download" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="./FIT_files/bootstrap.min.js.download" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    
    
    
    <link rel="stylesheet" href="./FIT_files/editormd.preview.css">
    
    
    <link type="text/css" rel="stylesheet" href="./FIT_files/katex.min.css">
    <script id="-cdnjs-cloudflare-com-ajax-libs-KaTeX-0-11-1-katex-min" type="text/javascript" src="./FIT_files/katex.min.js.download"></script>


    <title> FIT </title>
    
    <script>
        // Script to set/check cookies for "storing" user choices on alerts
        function showWhenRequired(id) {
            if (display(id)) {
                $("#" + id).show()
            }
        }

        function setCookie(cname, cvalue) {
            let exdate = new Date();
            exdate.setDate(exdate.getDate() + 5);
            document.cookie = cname + "=" + cvalue + "; expires=" + exdate.toUTCString() + ";path=/; SameSite=None; Secure";
        }

        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function display(cname) {
            var display = getCookie(cname);
            return (display === null || display === ""); // If null we have to display the alert
        }
    </script>
</head>

<body class="light-theme" style="padding-top: 90px; padding-bottom: 60px;">
<div class="container">
    



<nav id="navbar" class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <div class="navbar-brand">
            <a href="https://olj.ing.unimore.it/">
                <img src="./FIT_files/olj_logo.png" alt="olj" style="max-height:50px;"></a>
        </div>

        <a class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                
                <a class="nav-link active" href="https://olj.ing.unimore.it/course/3"> Multimedia Data Processing </a> 
                
                    <li class="nav-item dropdown">
                        <a class="dropdown-toggle nav-link" href="https://olj.ing.unimore.it/exam/390/exercise/view/1028#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Insegnamenti
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                            
                                <a class="dropdown-item" href="https://olj.ing.unimore.it/course/3">Multimedia Data Processing</a>
                            
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="https://olj.ing.unimore.it/">Tutti gli Insegnamenti</a>
                        </div>
                    </li>
                
                
                    <a class="nav-link" href="https://olj.ing.unimore.it/quiz/course/3">Quiz <span class="sr-only">(current)</span></a>



            </ul>
            <ul class="navbar-nav ml-auto">

                
                
                
                <!--Available Languages [(&#x27;en&#x27;, &#x27;Inglese&#x27;), (&#x27;it&#x27;, &#x27;Italiano&#x27;)] -->
                <li class="nav-item dropdown show">
                    <a class="nav-link" href="https://olj.ing.unimore.it/exam/390/exercise/view/1028#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img width="15px" src="./FIT_files/it.png">
                        &nbsp; <span class="caret"></span></a>
                    <div id="language-list" class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                        
                            <a class="dropdown-item" href="https://olj.ing.unimore.it/i18n/setlang/" data-language-code="en">
                                <img width="15px" src="./FIT_files/en.png">
                                Inglese
                                &nbsp;&nbsp;
                            </a>
                        
                            <a class="dropdown-item" href="https://olj.ing.unimore.it/i18n/setlang/" data-language-code="it">
                                <img width="15px" src="./FIT_files/it.png">
                                Italiano
                                ✓
                            </a>
                        
                    </div>
                </li>

                <li class="nav-item dropdown show">
                    
                        <a class="dropdown-toggle nav-link" href="https://olj.ing.unimore.it/profile/" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-user" aria-hidden="true"></i> Cristian Bellucci
                            
                                (322906)
                            
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                            <a class="dropdown-item" href="https://olj.ing.unimore.it/profile/">Profilo</a>
                            <a class="dropdown-item" href="https://olj.ing.unimore.it/accounts/logout/">Logout</a>
                        </div>
                    
                </li>
            </ul>
        </div>
    </div>
</nav>

<style>
    #navbar {
        font-size: large;
        background-color: #ECECEC;
    }
</style>
    <div class="extend row justify-content-center">
        <div class="col-12">
            
                <h1 class="mt-2"> FIT
    <a type="button" href="https://olj.ing.unimore.it/exercise/submit/1028/exam/390/" class="btn btn-success float-right mr-1"><i class="fa fa-upload" aria-hidden="true"></i>
        Submit Solution</a>
    
</h1>
                <hr class="mt-0 mb-4">
            
            
            
    <div id="test-editormd-view" class="markdown-body editormd-html-preview">
        <p>The Flexible and Interoperable Data Transfer (FIT) protocol is specifically tought to store and share data produced by sport, fitness and health devices. It is designed to be compact, interoperable and extensible.</p>
<p>The format consists of a header, a variable number of records and a final control code:</p>
<p><img src="./FIT_files/ek2rjjS.png" alt=""></p>
<p>The header is composed as follows:</p>
<table>
<thead>
<tr>
<th>Byte</th>
<th>Parameter</th>
<th>Description</th>
<th>Size (Bytes)</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Header Size</td>
<td>Indicates the length of this file header including header size.</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>Protocol Version</td>
<td>Protocol version number.</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Profile Version LSB</td>
<td>Profile version number. Little endian.</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>Profile Version MSB</td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>Data Size LSB</td>
<td>Length of the Data Records section in bytes. Does not include Header or CRC. Little endian.</td>
<td>4</td>
</tr>
<tr>
<td>5</td>
<td>Data Size</td>
<td></td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>Data Size</td>
<td></td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>Data Size MSB</td>
<td></td>
<td></td>
</tr>
<tr>
<td>8</td>
<td>Data Type Byte[0]</td>
<td>ASCII values for “.FIT”. A FIT binary file opened with a text editor will contain a readable “.FIT” in the first line.</td>
<td>4</td>
</tr>
<tr>
<td>9</td>
<td>Data Type Byte[1]</td>
<td></td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>Data Type Byte[2]</td>
<td></td>
<td></td>
</tr>
<tr>
<td>11</td>
<td>Data Type Byte[3]</td>
<td></td>
<td></td>
</tr>
<tr>
<td>12</td>
<td>CRC LSB</td>
<td>Contains the value of the CRC of Bytes 0 through 11. Little endian.</td>
<td>2</td>
</tr>
<tr>
<td>13</td>
<td>CRC MSB</td>
<td></td>
</tr>
</tbody>
</table>
<p>The function for calculating the CRC is provided in the attached project and has the following structure:</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-c++"><span class="kwd">void</span><span class="pln"> </span><span class="typ">FitCRC_Get16</span><span class="pun">(</span><span class="typ">uint16_t</span><span class="pun">&amp;</span><span class="pln"> crc</span><span class="pun">,</span><span class="pln"> </span><span class="typ">uint8_t</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">);</span></code></li></ol></pre>
<p>This function must be used with a CRC initially equal to 0, which is then updated at each call based on the provided byte.</p>
<p>To avoid including the thousands of fields supported by the format in each file, the records contain two types of message: <em>definition</em> message and <em>data</em> message.<br>The definition message takes a global identifier (Global Message Number) and links it to a local identifier (Local Message Type). Each data message contains only the values and a local message type that identifies the definition message that defines it.</p>
<p>Each record has a one-byte header in which the 4 most significant bits are 0 in the case of a data message and 4 in the case of a definition message. The 4 least significant bits are the local message type of the message.</p>
<p>For what concerns definition messages, the content of the record is as follows:</p>
<table>
<thead>
<tr>
<th>Byte</th>
<th>Description</th>
<th>Length</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Reserved</td>
<td>1 Byte</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>Architecture</td>
<td>1 Byte</td>
<td>Architecture Type <br> 0: Definition and Data Messages are Little Endian <br> 1: Definition and Data Message are Big Endian</td>
</tr>
<tr>
<td>2-3</td>
<td>Global Message Number</td>
<td>2 Bytes</td>
<td>0:65535 – Unique to each message <br> *Endianness of this 2 Byte value is defined in the Architecture byte</td>
</tr>
<tr>
<td>4</td>
<td>NumFields</td>
<td>1 Byte</td>
<td>Number of fields in the Data Message</td>
</tr>
<tr>
<td>5 – 4 + NumFields * 3</td>
<td>Field Definition</td>
<td>3 Bytes (per Field)</td>
<td>Field Definition: (number, size, base type)</td>
</tr>
</tbody>
</table>
<p><strong>In this exercise all data will be in little endian only.</strong> In practice, 16 different local message types (0-15) are possible in each file. For each type you will receive only one definition message and then many data messages. Each definition message contains a reference to a global message number reported in the standard. For example, the global message number 21 corresponds to the event message, which describes an event, such as pressing the start or stop button on the racing watch. The definition message associates the global message (e.g. 21) with a local 4-bit number (e.g. number 2). Data messages with local message type equal to 2 will contain event data.</p>
<p>The definition also indicates how many and which of the possible fields of the global message are actually used in data messages of that type. For example, the following record:</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="lit">42</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">05</span><span class="pln"> FD </span><span class="lit">04</span><span class="pln"> </span><span class="lit">86</span><span class="pln"> </span><span class="lit">03</span><span class="pln"> </span><span class="lit">04</span><span class="pln"> </span><span class="lit">86</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">01</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">01</span><span class="pln"> </span><span class="lit">01</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">04</span><span class="pln"> </span><span class="lit">01</span><span class="pln"> </span><span class="lit">02</span></code></li></ol></pre><p>is a definition (it starts with the 4 most significant bits that are 4) for the local message type 2 (following 4 bits). Then follows a 00 (reserved), the architecture is 00 (little endian), the global message number is 15 00 (or 0x0015, that is 21) and messages of this type will contain 05 fields in the following order:</p>
<ul>
<li>number: <code>FD</code> (253) size: <code>04</code> (4) base type: <code>86</code></li><li>number: <code>03</code> (3) size: <code>04</code> (4) base type: <code>86</code></li><li>number: <code>00</code> (0) size: <code>01</code> (1) base type: <code>00</code></li><li>number: <code>01</code> (1) size: <code>01</code> (1) base type: <code>00</code></li><li>number: <code>04</code> (4) size: <code>01</code> (1) base type: <code>02</code></li></ul>
<p>It is possible to know the size of a type 2 data message simply by adding the size of the fields and considering a byte for the header (which should be 02). To understand the meaning of the fields, it would be necessary to refer to the standard (this will not be required in this exercise). The data types of each field (base type) are also encoded in the standard, but will not be used for this exercise.</p>
<p>Write a command line program that accepts the following options:</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="pln">fitdump </span><span class="pun">&lt;</span><span class="pln">input file </span><span class="pun">.</span><span class="pln">FIT</span><span class="pun">&gt;</span></code></li></ol></pre><p>The program must handle the command line and:</p>
<ol>
<li>Read the file header and check that the CRC is correct. In this case, send to standard output:<br><code>Header CRC ok</code><br>otherwise stop the program and exit with return code 1.</li><li>Read the first record -this is a definition message with global message type 0 (file_id) that is associated with the local message type 0-, store the definition of the fields and read the next record that will contain the data: output the value of field 4 (time_created), which is an unsigned 32-bit integer (uint32_t), as a base 10 number with the following format:<br><code>time_created = 854803893</code></li><li>Read the entire file correctly and for each message with global message type 19 (lap) extract and output the value of field 13 (avg_speed), which is an unsigned 16-bit integer (uint16_t). The value is the average speed in the lap expressed in mm/s and must be reported in km/h with the following format (3 digits after the decimal point):<br><code>avg_speed = 7.614 km/h</code></li><li>After outputting all the lap type messages average speeds, at the end of the file (<strong>use the size found in the header</strong>), check that the data CRC matches the one stored in the last two bytes. In this case, send to standard output:<br><code>File CRC ok</code><br>otherwise stop the program and exit with return code 1.</li><li>Terminate the program with return code 0.</li></ol>
<p>An empty project (with the only function for calculating the CRC) and a dump.txt file that lists in textual format the contents of the example.fit file are provided in the material for the test. The overall output for this file should be:</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="typ">Header</span><span class="pln"> CRC ok</span></code></li><li class="L1"><code><span class="pln">time_created </span><span class="pun">=</span><span class="pln"> </span><span class="lit">854803893</span></code></li><li class="L2"><code><span class="pln">avg_speed </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7.614</span><span class="pln"> km</span><span class="pun">/</span><span class="pln">h</span></code></li><li class="L3"><code><span class="pln">avg_speed </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7.488</span><span class="pln"> km</span><span class="pun">/</span><span class="pln">h</span></code></li><li class="L4"><code><span class="pln">avg_speed </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9.165</span><span class="pln"> km</span><span class="pun">/</span><span class="pln">h</span></code></li><li class="L5"><code><span class="typ">File</span><span class="pln"> CRC ok</span></code></li></ol></pre>
    </div>
    

            <br class="mb-4">
        </div>
    </div>
</div>




<nav id="footer" class="navbar navbar-expand-lg navbar-light fixed-bottom">
    <div class="container">
        <div class="" style="horiz-align: left;">Powered by <a target="_blank" href="http://imagelab.ing.unimore.it/">
            <img src="./FIT_files/aimagelab.png" height="25" alt="AImageLab"></a>
        </div>
        <div class="" style="float: right !important;">
            Designed and Managed by <a href="http://federicobolelli.it/" target="_blank">F. Bolelli</a>, S. Allegretti
            and C. Grana
        </div>
    </div>
</nav>
<!-- Footer -->
<style>
    #footer {
        font-size: large;
        background-color: #ECECEC;
    
    }

    .container {
        max-width: 98%;
    }

    .custom-button {
        width: 200px !important;
        height: 200px !important;
        margin-right: 20px !important;
    }

    .btn-group-xs > .btn, .btn-xs {
        padding: .25rem .4rem;
        font-size: .875rem;
        line-height: .5;
        border-radius: .2rem;
    }

    /* Overrides list-group-item from Bootstrap */
    .list-group-item {
        background-color: transparent;
        padding: 3px 13px
    }

    /* Overrides list-group-item from Bootstrap */
    .teacher_block {
     background-color: #ffffff;
    }

    a:hover {
        text-decoration: none;
    }

    .mycontent-left {
        border-right: 1px dashed #333;
    }

    pre {
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    /* Overrides default Editor.md code style */
    .editormd-preview-container code, .editormd-html-preview code {
        background-color: transparent;
        border: none;
        margin: 0;
        padding: 0;
        color: #A31515;
        border-radius: 0;
        box-sizing: content-box;
    }

    .editormd-preview-container p code, .editormd-html-preview p code {
        margin: 0;
    }

    .editormd-preview-container code::before, .editormd-html-preview code::before {
        content: "";
    }

    .editormd-preview-container code::after, .editormd-html-preview code::after {
        content: "";
    }

    /* Reduce font size in Editor.md formulas */
    .editormd-preview-container .katex, .editormd-html-preview .katex {
        font-size: 1.2em !important;
    }
</style>

<script type="text/javascript">
    $('#language-list a').on('click', function (event) {
        event.preventDefault();
        var target = $(event.target);
        var url = target.attr('href');
        var language_code = target.data('language-code');
        $.ajax({
            type: 'POST',
            url: url,
            data: {language: language_code},
            headers: {"X-CSRFToken": getCookie('csrftoken')}
        }).done(function (data, textStatus, jqXHR) {
            window.location.reload(true);
        });
    });
</script>
</body><!-- Footer --></html>